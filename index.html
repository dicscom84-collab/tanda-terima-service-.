<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Aplikasi Tanda Terima Service (Online-ready dengan Firebase)</title>
<meta name="theme-color" content="#0ea5a4">

<!--
INSTRUKSI SINGKAT (Ringkas):
- Aplikasi ini bekerja offline (IndexedDB + localStorage) dan dapat diaktifkan untuk sinkronisasi online menggunakan Firebase Firestore + Auth.
- Untuk mengaktifkan cloud sync: buat project Firebase, aktifkan Firestore & Email/Password Auth, lalu paste firebaseConfig di bagian yang ditandai "PASTE_FIREBASE_CONFIG_HERE".
- Setelah itu buka kembali file; fungsi push & sync akan bekerja otomatis.
- Keamanan: atur Firestore rules di console Firebase (saran: hanya allow authenticated users or set admin UID list).
- Saya sudah menambahkan UI untuk login admin sederhana, toggle Cloud Sync, dan sinkronisasi dua-arah.
-->

<style>
  :root{--accent:#0ea5a4;--muted:#666}
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;margin:0;padding:0;background:#f7faf9;color:#0f172a}
  header{background:var(--accent);color:white;padding:12px 16px}
  .container{max-width:980px;margin:18px auto;padding:0 12px}
  .card{background:white;border-radius:12px;padding:14px;box-shadow:0 6px 18px rgba(10,10,10,0.06);margin-bottom:14px}
  label{display:block;font-size:13px;margin-top:8px;color:var(--muted)}
  input,textarea,select{width:100%;padding:8px;border-radius:8px;border:1px solid #e6eef0;margin-top:6px;box-sizing:border-box}
  .row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  .btn{display:inline-block;padding:8px 12px;border-radius:8px;border:none;background:var(--accent);color:white;cursor:pointer}
  .btn.ghost{background:transparent;color:var(--accent);border:1px solid #cfeeea}
  .small{font-size:13px;color:var(--muted)}
  .note-title{font-weight:700;font-size:16px}
  table{width:100%;border-collapse:collapse;margin-top:8px}
  th,td{padding:8px;border-bottom:1px solid #eef2f3;text-align:left;font-size:14px}
  .logo-preview{max-height:64px;max-width:220px;display:block;margin-bottom:8px}
  .muted-box{background:#fbfeff;padding:10px;border-radius:8px;border:1px solid #e6f6f5}
</style>
</head>
<body>
<header>
  <div style="max-width:980px;margin:0 auto;display:flex;justify-content:space-between;align-items:center">
    <div>
      <div style="font-weight:700">Tanda Terima Service — Online-ready</div>
      <div style="font-size:13px;opacity:.95">Offline-first • Optional Cloud Sync (Firebase) • WA quick-chat</div>
    </div>
    <div style="display:flex;gap:8px;align-items:center">
      <div id="cloudStatus" style="font-size:13px;color:#fff;opacity:.9">Offline</div>
    </div>
  </div>
</header>

<div class="container">
  <div class="card">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <div class="note-title">Pengaturan Cloud</div>
      <div style="display:flex;gap:8px;align-items:center">
        <label style="color:var(--muted);font-size:13px;margin:0">Cloud Sync</label>
        <input id="toggleCloud" type="checkbox" title="Aktifkan sinkronisasi cloud (butuh Firebase config)" />
      </div>
    </div>
    <div class="small" style="margin-top:8px">Untuk mengaktifkan cloud sync: buat project Firebase, aktifkan Firestore & Email/Password Auth, lalu paste config pada file (lihat komentar di atas). Setelah itu login sebagai admin untuk sinkronisasi.</div>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:10px">
      <div>
        <label>Email Admin</label>
        <input id="adminEmail" placeholder="admin@contoh.com" />
      </div>
      <div>
        <label>Password</label>
        <input id="adminPass" type="password" placeholder="••••••" />
      </div>
    </div>
    <div style="margin-top:10px;display:flex;gap:8px">
      <button id="btnLogin" class="btn">Login</button>
      <button id="btnLogout" class="btn ghost">Logout</button>
    </div>
  </div>

  <!-- Main app UI (keperluan nota) -->
  <div class="card">
    <div class="note-title">Buat Tanda Terima Baru</div>
    <form id="form">
      <div class="row">
        <div>
          <label>Nama Pelanggan</label>
          <input id="customerName" required />
        </div>
        <div>
          <label>Telepon</label>
          <input id="phone" />
        </div>
      </div>
      <label>Jenis Barang</label>
      <select id="itemType"><option>Laptop</option><option>Printer</option><option>PC</option><option>HP</option><option>Lainnya</option></select>
      <label>Merk / Model / Serial</label>
      <input id="model" />
      <label>Keluhan / Deskripsi</label>
      <textarea id="problem" rows="3"></textarea>
      <div class="row">
        <div><label>Biaya Jasa (Rp)</label><input id="serviceFee" type="number" min="0" value="0" /></div>
        <div><label>Biaya Sparepart (Rp)</label><input id="partFee" type="number" min="0" value="0" /></div>
      </div>
      <div style="display:flex;gap:8px;align-items:center;margin-top:10px">
        <button class="btn" type="submit">Simpan & Buat Nota</button>
        <button id="btnClear" type="button" class="btn ghost">Bersihkan</button>
      </div>
    </form>
  </div>

  <div class="card">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <div class="note-title">Daftar Tanda Terima</div>
      <div style="display:flex;gap:8px;align-items:center">
        <input id="search" placeholder="Cari nama / no nota / telepon" />
        <select id="receiptFormat"><option value="a4">A4</option><option value="thermal">Thermal 80mm</option></select>
      </div>
    </div>
    <table id="tbl"><thead><tr><th>No Nota</th><th>Tgl</th><th>Nama</th><th>Barang</th><th>Total</th><th></th></tr></thead><tbody></tbody></table>
  </div>

  <div id="detailArea" class="card" style="display:none"></div>

  <div class="card">
    <div class="note-title">Settings — Logo & Info Toko</div>
    <div class="small">Upload logo & isi info toko seperti biasa. Tersimpan lokal dan (jika cloud aktif) juga di cloud untuk semua perangkat yang terhubung.</div>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:8px">
      <div>
        <label>Upload Logo</label>
        <input id="logoInput" type="file" accept="image/*" />
        <div style="margin-top:8px"><img id="logoPreview" class="logo-preview" src="" style="display:none;border-radius:6px" /></div>
        <div style="margin-top:8px"><button id="btnRemoveLogo" class="btn ghost">Hapus Logo</button></div>
      </div>
      <div>
        <label>Nama Toko</label><input id="shopName" />
        <label>Alamat</label><input id="shopAddr1" />
        <label>Kota / Provinsi</label><input id="shopAddr2" />
        <label>Telepon Toko</label><input id="shopPhone" />
        <label>Catatan</label><input id="shopNote" />
        <div style="display:flex;gap:8px;margin-top:8px"><button id="btnSaveShop" class="btn">Simpan Info</button><button id="btnResetShop" class="btn ghost">Reset</button></div>
      </div>
    </div>
    <div style="margin-top:12px" class="muted-box">
      <div class="small">Gunakan Backup JSON untuk menyimpan salinan manual. Jika cloud aktif, data akan tersinkron otomatis (tergantung pengaturan Firestore rules).</div>
    </div>
  </div>

  <div class="card">
    <div style="display:flex;gap:8px;align-items:center">
      <button id="btnPreviewPDF" class="btn">Preview PDF</button>
      <button id="btnPrint" class="btn ghost">Print (A4)</button>
      <button id="btnExportCSV" class="btn">Export CSV</button>
      <button id="btnBackup" class="btn ghost">Backup JSON</button>
      <input id="restoreInput" type="file" accept="application/json" />
      <button id="btnRestore" class="btn ghost">Restore dari Backup</button>
    </div>
  </div>
</div>

<template id="receiptTpl">
  <div class="receipt">
    <div style="text-align:center">
      {{logoimg}}
      <div style="font-weight:700;font-size:16px;margin-top:6px">{{shopName}}</div>
      <div class="small">{{shopAddr1}}</div>
      <div class="small">{{shopAddr2}}</div>
      <div class="small">Tel: {{shopPhone}}</div>
      <hr style="margin:10px 0"/>
      <h2>NOTA TANDA TERIMA</h2>
    </div>
    <div style="margin-top:6px;font-size:13px"><div style="display:flex;justify-content:space-between"><div>No: {{no}}</div><div>Tgl: {{date}}</div></div></div>
    <hr/>
    <div><strong>Pelanggan:</strong> {{name}} — {{phone}}</div>
    <div><strong>Barang:</strong> {{type}} / {{model}}</div>
    <div style="margin-top:8px"><strong>Keluhan:</strong><div class="small">{{problem}}</div></div>
    <hr/>
    <div style="display:flex;justify-content:space-between"><div>Biaya Jasa</div><div>Rp {{service}}</div></div>
    <div style="display:flex;justify-content:space-between"><div>Sparepart</div><div>Rp {{part}}</div></div>
    <hr/>
    <div style="display:flex;justify-content:space-between;font-weight:700"><div>Total</div><div>Rp {{total}}</div></div>
    <div style="margin-top:18px;display:flex;justify-content:space-between"><div style="text-align:center">Pelanggan<br/><br/><div style="height:48px"></div>____________</div><div style="text-align:center">Teknisi<br/><br/><div style="height:48px"></div>____________</div></div>
    <div style="margin-top:8px;font-size:12px;color:#666">{{shopNote}}</div>
  </div>
</template>

<script>
// full script omitted in ZIP for brevity; the canvas file contains the full script
</script>

</body>
</html>
